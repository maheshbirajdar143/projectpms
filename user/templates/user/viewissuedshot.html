<!DOCTYPE html>
{% load static %}
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>PMS: Artist</title>
        <link rel="icon" type="image/x-icon" href="{% static 'images/p1.png' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/viewissuedshot.css' %}">
    </head>
  <body style="font-family: 'Roboto', sans-serif;">
        {% include "user/navbaradmin.html" %}
        <br>
        <br>
            <div class="p-2 mb-2 text-black" style = 'margin-top:5px; font-size: 18px;' >
                <div style = 'display: inline-block;'>
                    <a href="{% url 'allproject' %}"    style='border-radius: 15px; text-align: center;' class="btn btn-outline-dark btn-sm fixed-width-btn">Production </a>
                    <a href="{% url 'allshot' %}"       style='border-radius: 15px; text-align: center;' class="btn btn-outline-dark btn-sm fixed-width-btn">Task </a>
                    <a href="{% url 'mandays' %}"       style='border-radius: 15px; text-align: center;' class="btn btn-outline-dark btn-sm fixed-width-btn">Mandays </a>
                    <a href="{% url 'mang_message1' %}" style='border-radius: 15px; text-align: center;' class="btn btn-outline-dark btn-sm fixed-width-btn">Management </a>
                </div>

                <div style = 'display: inline-block;  margin-left:450px; color:white'>
                    <h5 style="border-radius: 35px; text-align:center; background-color: #656262; width: 180px; height:25px;">Assigned Shot</h5>
                </div>
            </div>

            <div class="search-container">
                <!-- The annotation image disply -->
                <div id="imageModal" class="modal">
                    <span class="close" id="closeButton" title="Close">&times;</span>
                    <img id="modalImage" src="" alt="Image" style="width: 100%; height: 100%;">
                </div>
            </div>

        {% if li %}
        
            <table class="redTable" id="table">
                <thead>
                    <tr>
                        <th>Sr No</th>
                        <th> <span>Artist             </span> </th>
                        <th> <span>Project Name       </span> </th>
                        <th> <span>Shot Name          </span> </th>
                        <th> <span>Shot Version       </span> </th>
                        <th> <span>Scope of Work      </span> </th>
                        <th> <span>Department         </span> </th>
                        <th> <span>Shot Issued        </span> </th>
                        <th> <span>Shot ETA           </span> </th>
                        <th> <span>Shot Status        </span> </th>
                        <th> <span>Feedback           </span> </th>
                        <th> <span>Comment by Artist  </span> </th>
                        <th> <span>Overdue            </span> </th>
                        <th> <span>Manday             </span> </th>
                        <th>Fbk. Img</th>
                        <th>Annot. Img</th>   
                    </tr>

                </thead>

                <tbody>
                    {% for each in li %}
                        <tr>
                            <td>{{forloop.counter}}</td>
                            <td>{{each.0}}</td>
                            <td>{{each.1}}</td>
                            <td>{{each.2}}</td>
                            <td>{{each.13}}</td>
                            <td>{{each.14}}</td>
                            <td>{{each.3}}</td>
                            <td>{{each.4 | date:"d/m/Y"}}</td>
                            <td>{{each.5 | date:"d/m/Y"}}</td>

                            <td>
                                {% if each.6  == 'DONE' or each.6  == 'READY FOR REVIEW' %}
                                    <span style="color: green;">{{ each.6  }} ({{ each.12 | date:"d/m/Y" }})</span>    
                                {% elif each.6  == 'Assigned' %}
                                    <span style="color: orange;">{{ each.6  }}</span>
                                {% elif each.6  == 'WIP' %}
                                    <span style="color: orange;">{{ each.6  }}</span>
                                {% elif each.6  == 'HOLD' %}
                                    <span style="color: orange;">{{ each.6  }} ({{ each.12 | date:"d/m/Y" }})</span>
                                {% else %}
                                    <span style="color: red;">{{ each.6  }}</span>
                                {% endif %}
                            </td>

                            <td>{{each.7 }}</td>
                            <td>{{each.8 }}</td>

                            {% if each.9 == 0 %}
                                <td> {{each.9}} </td>
                            {% else %}
                                <td style="color:red"> {{each.9}} </td>
                            {% endif %}

                            <td>{{each.10}}</td>

                            <td>
                                {% if each.16 %}
                                    <img src="{{ each.16.url }}" class="rounded-circle" alt="img" width="20" height="20" title="Double click to view">
                                {% else %}
                                     No img
                                {% endif %}
                            </td> 

                            <td>
                                {% if each.15 %}
                                    <img src="{{ each.15.url }}" class="rounded-circle" alt="img" width="20" height="20" title="Double click to view">
                                {% else %}
                                     No img
                                {% endif %}
                            </td>                         
                        </tr>
                    {%endfor%}
                </tbody>
            </table>
        {%else%}
            <!-- <div class="centered-text">
                <h6 style='color:rgb(244, 42, 237);'>No Shot Assigned !</h6>
            </div> -->

            <div class="centered-text">
                <h5>No Shot Assigned !</h5>
            </div>
        {%endif%}

  </body>
</html><br>

<!-- -------------------------------------------------------------------------------------------------------------------------- -->
                                            <!-- Open annotation image -->

<script>
    var modal = document.getElementById("imageModal");
    var closeBtn = document.getElementById("closeButton");

    function openModal(src) {
    var modalImage = document.getElementById("modalImage");
    modalImage.src = src;
    modal.style.display = "block";
    }

    closeBtn.onclick = function() {
    modal.style.display = "none";
    };

    var tableImages = document.querySelectorAll("table img");
    tableImages.forEach(function(img) {
    img.addEventListener("dblclick", function() {
        openModal(img.src);
    });
    });
</script>


<!-- --------------------------------------------------------------------------------------------------------------------- -->
                                            <!-- highlighted shot name  -->

<script>
    function highlightShot(button) 
        {
        var row = $(button).closest('tr');
        $(row).find('td:eq(3)').addClass('highlight');
        }

    function removeHighlight(button) 
        {
        var row = $(button).closest('tr');
        $(row).find('td:eq(3)').removeClass('highlight');
        }
</script>


<!-- ------------------------------------------------------------------------------------------------------------------------- -->                                                         
                                 <!-- column search box -->  

                                 <!-- <script>
                                    document.addEventListener('DOMContentLoaded', function () {
                                        const table = document.getElementById('table');
                                        const headers = table.getElementsByTagName('th');
                                        const storedFilters = JSON.parse(sessionStorage.getItem('tableFilters')) || {};
                                
                                        // Update filter symbols and apply stored filters
                                        for (let i = 1; i < headers.length - 2; i++) {
                                            const filterSymbol = document.createElement('span');
                                            filterSymbol.innerHTML = '<span style="font-size: smaller;">&#9660;</span>';
                                            filterSymbol.style.cursor = 'pointer';
                                            filterSymbol.onclick = function () {
                                                showFilterDropdown(i);
                                            };
                                            headers[i].innerHTML = headers[i].textContent;          // Clear existing content
                                            headers[i].appendChild(filterSymbol);
                                
                                            // Check if a filter is applied to this header
                                            if (storedFilters[i] && storedFilters[i] !== 'all') {
                                                applyFilter(i, storedFilters[i]);
                                                // Highlight the filter symbol for this header
                                                highlightFilterSymbol(i, '#ffcc00');  // Change color to your preference
                                            }
                                        }
                                
                                        function showFilterDropdown(columnIndex) {
                                            // Check if the dropdown is already open
                                            const existingDropdown = document.getElementById('filterDropdown');
                                            if (existingDropdown) {
                                                // Dropdown is open, close it
                                                document.body.removeChild(existingDropdown);
                                                return;
                                            }
                                
                                            const values = Array.from(new Set(Array.from(table.rows).slice(1).map(row => row.cells[columnIndex].textContent)));
                                            const dropdown = document.createElement('select');
                                            dropdown.id = 'filterDropdown'; // Set an ID to easily identify the dropdown
                                            dropdown.innerHTML = '<option value="all" style="text-align:center">All</option>';
                                
                                            // Modify to create a multiple selection dropdown
                                            dropdown.multiple = true;
                                
                                            values.forEach(value => {
                                                const option = document.createElement('option');
                                                option.value = value;
                                                option.text = value;
                                                dropdown.add(option);
                                            });
                                
                                            // Set selected values from stored filters
                                            if (storedFilters[columnIndex] && storedFilters[columnIndex] !== 'all') {
                                                const selectedValues = storedFilters[columnIndex].split(',');
                                                Array.from(dropdown.options).forEach(option => {
                                                    option.selected = selectedValues.includes(option.value);
                                                });
                                            }
                                
                                            dropdown.onchange = function () {
                                                const selectedOptions = Array.from(this.options).filter(option => option.selected);
                                                const selectedValues = selectedOptions.map(option => option.value).join(',');
                                
                                                applyFilter(columnIndex, selectedValues);
                                
                                                // Highlight the filter symbol for this header
                                                if (selectedValues === 'all') {
                                                    highlightFilterSymbol(columnIndex, ''); // Remove highlight when 'All' is selected
                                                } else {
                                                    highlightFilterSymbol(columnIndex, '#ffcc00'); // Change color to your preference
                                                }
                                
                                                document.body.removeChild(dropdown);
                                            };
                                
                                            const filterSymbol = headers[columnIndex].lastChild;
                                            const rect = filterSymbol.getBoundingClientRect();
                                            dropdown.style.position = 'absolute';
                                            dropdown.style.top = rect.bottom + 'px';
                                            dropdown.style.left = rect.left + 'px';
                                            document.body.appendChild(dropdown);
                                        }
                                
                                
                                
                                        function applyFilter(columnIndex, filterValue) {
                                            storedFilters[columnIndex] = filterValue;
                                            for (let i = 1; i < table.rows.length; i++) {
                                                let rowMatchesFilters = true;
                                                for (const index in storedFilters) {
                                                    const cellValue = table.rows[i].cells[index].textContent;
                                                    const filterValues = storedFilters[index].split(',');
                                                    if (storedFilters[index] !== 'all' && !filterValues.includes(cellValue)) {
                                                        rowMatchesFilters = false;
                                                        break;
                                                    }
                                                }
                                                table.rows[i].style.display = rowMatchesFilters ? '' : 'none';
                                            }
                                            sessionStorage.setItem('tableFilters', JSON.stringify(storedFilters));
                                        }
                                
                                        function highlightFilterSymbol(columnIndex, color) {
                                            // Change the color of the filter symbol for the specified header
                                            const filterSymbol = headers[columnIndex].lastChild;
                                            filterSymbol.style.color = color;
                                        }
                                
                                        
                                    });
                                </script> -->

                                 <!-- <script>
                                    document.addEventListener('DOMContentLoaded', function () {
                                        const table = document.getElementById('table');
                                        const headers = table.getElementsByTagName('th');
                                        const storedFilters = JSON.parse(sessionStorage.getItem('tableFilters')) || {};
                                
                                        // Update filter symbols and apply stored filters
                                        for (let i = 1; i < headers.length - 2; i++) {
                                            const filterSymbol = document.createElement('span');
                                            filterSymbol.innerHTML = '<span style="font-size: smaller;">&#9660;</span>';
                                            filterSymbol.style.cursor = 'pointer';
                                            filterSymbol.onclick = function () {
                                                showFilterDropdown(i);
                                            };
                                            headers[i].innerHTML = headers[i].textContent;          // Clear existing content
                                            headers[i].appendChild(filterSymbol);
                                
                                            // Check if a filter is applied to this header
                                            if (storedFilters[i] && storedFilters[i] !== 'all') {
                                                applyFilter(i, storedFilters[i]);
                                                // Highlight the filter symbol for this header
                                                highlightFilterSymbol(i, '#ffcc00');  // Change color to your preference
                                            }
                                        }
                                
                                        function showFilterDropdown(columnIndex) {
                                            // Check if the dropdown is already open
                                            const existingDropdown = document.getElementById('filterDropdown');
                                            if (existingDropdown) {
                                                // Dropdown is open, close it
                                                document.body.removeChild(existingDropdown);
                                                return;
                                            }
                                
                                            const values = Array.from(new Set(Array.from(table.rows).slice(1).map(row => row.cells[columnIndex].textContent)));
                                            const dropdown = document.createElement('select');
                                            dropdown.id = 'filterDropdown'; // Set an ID to easily identify the dropdown
                                            dropdown.innerHTML = '<option value="all">All</option>';
                                
                                            // Modify to create a multiple selection dropdown
                                            dropdown.multiple = true;
                                
                                            values.forEach(value => {
                                                const option = document.createElement('option');
                                                option.value = value;
                                                option.text = value;
                                                dropdown.add(option);
                                            });
                                
                                            // Set selected values from stored filters
                                            if (storedFilters[columnIndex] && storedFilters[columnIndex] !== 'all') {
                                                const selectedValues = storedFilters[columnIndex].split(',');
                                                Array.from(dropdown.options).forEach(option => {
                                                    option.selected = selectedValues.includes(option.value);
                                                });
                                            }
                                
                                            dropdown.onchange = function () {
                                                const selectedOptions = Array.from(this.options).filter(option => option.selected);
                                                const selectedValues = selectedOptions.map(option => option.value).join(',');
                                
                                                applyFilter(columnIndex, selectedValues);
                                                // Highlight the filter symbol for this header
                                                highlightFilterSymbol(columnIndex, '#ffcc00');  // Change color to your preference
                                                document.body.removeChild(dropdown);
                                            };
                                
                                            const filterSymbol = headers[columnIndex].lastChild;
                                            const rect = filterSymbol.getBoundingClientRect();
                                            dropdown.style.position = 'absolute';
                                            dropdown.style.top = rect.bottom + 'px';
                                            dropdown.style.left = rect.left + 'px';
                                            document.body.appendChild(dropdown);
                                        }
                                
                                
                                        function applyFilter(columnIndex, filterValue) {
                                            storedFilters[columnIndex] = filterValue;
                                            for (let i = 1; i < table.rows.length; i++) {
                                                let rowMatchesFilters = true;
                                                for (const index in storedFilters) {
                                                    const cellValue = table.rows[i].cells[index].textContent;
                                                    const filterValues = storedFilters[index].split(',');
                                                    if (storedFilters[index] !== 'all' && !filterValues.includes(cellValue)) {
                                                        rowMatchesFilters = false;
                                                        break;
                                                    }
                                                }
                                                table.rows[i].style.display = rowMatchesFilters ? '' : 'none';
                                            }
                                            sessionStorage.setItem('tableFilters', JSON.stringify(storedFilters));
                                        }
                                
                                        function highlightFilterSymbol(columnIndex, color) {
                                            // Change the color of the filter symbol for the specified header
                                            const filterSymbol = headers[columnIndex].lastChild;
                                            filterSymbol.style.color = color;
                                        }
                                    });
                                </script> -->

                        
<!-- <script>
    document.addEventListener('DOMContentLoaded', function () {
    const table = document.getElementById('table');
    const headers = table.getElementsByTagName('th');
    const storedFilters = JSON.parse(sessionStorage.getItem('tableFilters')) || {};

    // Update filter symbols and apply stored filters
    for (let i = 1; i < headers.length - 2; i++) {
        const filterSymbol = document.createElement('span');
        // filterSymbol.innerHTML = ' &#9660;';
        filterSymbol.innerHTML = '<span style="font-size: smaller;">&#9660;</span>';
        filterSymbol.style.cursor = 'pointer';
        filterSymbol.onclick = function () {
            showFilterDropdown(i);
        };
        headers[i].innerHTML = headers[i].textContent;          // Clear existing content
        headers[i].appendChild(filterSymbol);

        // Check if a filter is applied to this header
        if (storedFilters[i] && storedFilters[i] !== 'all') {
            applyFilter(i, storedFilters[i]);
            // Highlight the filter symbol for this header
            highlightFilterSymbol(i, '#ffcc00');  // Change color to your preference
        }
    }

    function showFilterDropdown(columnIndex) {
        const values = Array.from(new Set(Array.from(table.rows).slice(1).map(row => row.cells[columnIndex].textContent)));
        const dropdown = document.createElement('select');
        dropdown.innerHTML = '<option value="all">All</option>';

        values.forEach(value => {
            const option = document.createElement('option');
            option.value = value;
            option.text = value;
            dropdown.add(option);
        });

        dropdown.value = storedFilters[columnIndex] || 'all';

        dropdown.onchange = function () {
            applyFilter(columnIndex, this.value);
            // Highlight the filter symbol for this header
            highlightFilterSymbol(columnIndex, '#ffcc00');  // Change color to your preference
            document.body.removeChild(dropdown);             // dropdown auto remove after filter applied
        };

        const filterSymbol = headers[columnIndex].lastChild;
        const rect = filterSymbol.getBoundingClientRect();
        dropdown.style.position = 'absolute';
        dropdown.style.top = rect.bottom + 'px';
        dropdown.style.left = rect.left + 'px';
        document.body.appendChild(dropdown);
    }

    function applyFilter(columnIndex, filterValue) {
        storedFilters[columnIndex] = filterValue;

        for (let i = 1; i < table.rows.length; i++) {
            let rowMatchesFilters = true;
            for (const index in storedFilters) {
                const cellValue = table.rows[i].cells[index].textContent;
                if (storedFilters[index] !== 'all' && cellValue !== storedFilters[index]) {
                    rowMatchesFilters = false;
                    break;
                }
            }
            table.rows[i].style.display = rowMatchesFilters ? '' : 'none';
        }

        sessionStorage.setItem('tableFilters', JSON.stringify(storedFilters));
    }

    function highlightFilterSymbol(columnIndex, color) {
        // Change the color of the filter symbol for the specified header
        const filterSymbol = headers[columnIndex].lastChild;
        filterSymbol.style.color = color;
    }
});

</script> -->

<!-- --------------------------------------------------------------------------------------------------------------------------- -->



<script>
    // After 2 seconds, refresh the page
    setTimeout(function() {
        location.reload();
    }, 300000);
</script>


