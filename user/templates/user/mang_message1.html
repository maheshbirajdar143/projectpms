<!DOCTYPE html>
{% load static %}
<html lang="en" dir="ltr">
    <head>
        <title> PMS: Management </title>
        <link rel="icon" type="image/x-icon" href="{% static 'images/p1.png' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/mang_message1.css' %}">
    </head>

  <body style="font-family: 'Roboto', sans-serif;">
    {% include "user/navbaradmin.html" %}
    <br>
    <br>  
            <div class="p-2 mb-2 text-black" style="font-size: 18px;">
                <div style = 'display: inline-block;'>
                    <a href="{% url 'allproject' %}"     style='border-radius: 15px; text-align: center;'  class="btn btn-outline-dark btn-sm fixed-width-btn">Production</a>
                    <a href="{% url 'allshot' %}"        style='border-radius: 15px; text-align: center;'  class="btn btn-outline-dark btn-sm fixed-width-btn">Task</a>
                    <a href="{% url 'mandays' %}"        style='border-radius: 15px; text-align: center;'  class="btn btn-outline-dark btn-sm fixed-width-btn">Mandays</a>
                    <a href="{% url 'viewissuedshot' %}" style='border-radius: 15px; text-align: center;'  class="btn btn-outline-dark btn-sm fixed-width-btn">Artist</a>
                </div>

                <div style = 'display: inline-block;  margin-left:500px; margin-top:5px; color:white'>
                    <h5 style="border-radius: 35px; text-align:center; background-color: #656262; width: 150px; height:25px;">Management</h5>
                </div>
            </div>
                

        {% if shots%}

            <table class="redTable" id="table">
                <thead>
                    <tr>
                        <th>Sr.No </th>
                        <th><span>Project Name  </span>  </th>
                        <th><span>Shot Name     </span>  </th>
                        <th><span>Shot Version  </span>  </th>
                        <th><span>Dependency    </span>  </th>
                        <th><span>Scope of Work </span>  </th>
                        <th><span>Assignment    </span>  </th>
                        <th><span>Int Status    </span>  </th>
                        <th>Approval Status </th>
                    </tr>
                </thead>

                <tbody>
                    {% for shot in shots %}
                        <tr>
                            <td>{{ forloop.counter }}</td>
                            <td>{{ shot.project_name }}</td>

                            <td>
                                <a href="javascript:void(0);" onclick="openPopupz(`{% url 'get_review_approval_info' shot.id %}`)"
                                    title="Click here to view shot info">{{ shot.shot_name }}
                                </a>
                            </td>

                                <div id="popup-container1" class="popup-container1"  onclick="closePopupz(event)">
                                    <div class="popup-content1" onclick="event.stopPropagation();">
                                        <span class="close-button1" onclick="closePopupz()" title="Close">&times;</span>
                                        <iframe id="popup-iframe" src="" frameborder="0"></iframe>
                                    </div>
                                </div>

                            <td>{{ shot.shot_version }}</td>
                            <td>{{ shot.dependency|safe }}</td>
                            <td class="description-cell">{{ shot.work_description }}</td>
                            
                            <td style="position: relative;">
                                {% if shot.work_status == 'Assigned' %}
                                    <span style="color: orange;">{{ shot.work_status }}</span>

                                    <a href="javascript:void(0);" onclick="openPopupz(`{% url 'shotdep' shot.id %}`)" title="Shot assigned & status info" style="position: absolute; right: 0;"
                                        onmouseover="highlightShot(this)" onmouseout="removeHighlight(this)">&#x1F4DD;
                                    </a>
                                {% else %}
                                    <span style="color: red;">{{ shot.work_status }}</span>
                                {% endif %}
                            </td>
                              
                                    <div id="popup-container1" class="popup-container1"  onclick="closePopupz(event)">
                                        <div class="popup-content1" onclick="event.stopPropagation();">
                                            <span class="close-button1" onclick="closePopupz()" title="Close">&times;</span>
                                            <iframe id="popup-iframe" src="" frameborder="0"></iframe>
                                        </div>
                                    </div>
                            
                            <td>
                                {% if shot.internal_status == 'READY FOR REVIEW' %}
                                    <span style="color: green;">{{ shot.internal_status }}</span>
                                {% elif 'REVIEWED' in shot.internal_status %}
                                    <span style="color: #4dc3ff;;">{{shot.internal_status}}</span>    
                                {% elif shot.internal_status == 'WIP'  %}
                                    <span style="color: orange;">{{ shot.internal_status }}</span>
                                {% elif shot.internal_status == 'HOLD' or shot.internal_status == 'OMMIT' %}
                                    <span style="color: #ff4de1;">{{ shot.internal_status }}</span>
                                {% elif shot.internal_status == 'YTS' %}
                                    <span style="color: red;">{{shot.internal_status}} </span>   
                                {% else %}    
                                    <span>{{shot.internal_status}}</span>                                                         
                                {% endif %}
                            </td>

                            {% if shot.final_status == 'Approved By Sup' %}
                                <td style="color: green;">Approved By Sup</td>
                            {% else %}
                                <td>
                                    {% if 'Approved By Lead' in shot.internal_status %}
                                        <a href="{% url 'final_approved_shot' shot.id %}">
                                            <button type="button" class="btn btn-outline-success btn-sm" style="border-radius: 25px;"
                                                onmouseover="highlightShot(this)" onmouseout="removeHighlight(this)"
                                                onclick="return confirm('Are you sure, you want to approve this?');" title="Approve By Sup/Mang.">&#10004;
                                            </button>
                                        </a>
                                        
                                        <a href="{% url 're_issueshot_sup' %}?shot_name={{ shot.shot_name }}&project_name={{ shot.project_name }}&work_description={{ shot.work_description }}&shot_version={{ shot.shot_version }}">
                                            <button type="button" class="btn btn-outline-danger btn-sm" style="border-radius: 25px;"
                                                onmouseover="highlightShot(this)" onmouseout="removeHighlight(this)" title="Kick-back By Sup">X
                                            </button>
                                        </a>
                                    {% else %} 
                                        <a href="#"><button type="button" style="border-radius: 25px;" class="btn btn-outline-success btn-sm" disabled>&#10004;</button></a>
                                    {% endif %}  
                                </td>  
                            {% endif %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <!-- <div class="centered-text">
                <h6 style='color:rgb(244, 42, 237);'>Shots Not Available For Approval !</h6>
            </div> -->

            <div class="centered-text">
                <h5>Shots Not Available For Approval !</h5>
            </div>
        {%endif%}  
       
  </body>
</html><br>

<!-- ------------------------------------------------------------------------------------------------------------------------ -->
                                 <!-- popup for shot info -->

                                 <script>
                                    function openPopupz(url) {
                                    var popupContainer = document.getElementById('popup-container1');
                                    var popupIframe = document.getElementById('popup-iframe');
                                
                                    popupIframe.src = url;
                                    popupContainer.style.display = 'block';
                                
                                    document.body.addEventListener('click', closePopupzOutside);
                                    }
                                
                                    function closePopupz() {
                                        var popupContainer = document.getElementById('popup-container1');
                                        popupContainer.style.display = 'none';
                                    }
                                </script>

<!-- ------------------------------------------------------------------------------------------------------------------------- -->
                             <!-- when cursor move highlight shot -->

<script>
    function highlightShot(button) {
    var row = $(button).closest('tr');
    $(row).find('td:eq(2)').addClass('highlight');
    }

    function removeHighlight(button) {
    var row = $(button).closest('tr');
    $(row).find('td:eq(2)').removeClass('highlight');
    }
    </script>  
                      
<!-- ---------------------------------------------------------------------------------------------------------------------------------------------- -->
                                <!-- column search box -->
                                
                                <!-- <script>
                                    document.addEventListener('DOMContentLoaded', function () {
                                        const table = document.getElementById('table');
                                        const headers = table.getElementsByTagName('th');
                                        const storedFilters = JSON.parse(sessionStorage.getItem('tableFilters')) || {};
                                
                                        // Update filter symbols and apply stored filters
                                        for (let i = 1; i < headers.length - 1; i++) {
                                            const filterSymbol = document.createElement('span');
                                            filterSymbol.innerHTML = '<span style="font-size: smaller;">&#9660;</span>';
                                            filterSymbol.style.cursor = 'pointer';
                                            filterSymbol.onclick = function () {
                                                showFilterDropdown(i);
                                            };
                                            headers[i].innerHTML = headers[i].textContent;          // Clear existing content
                                            headers[i].appendChild(filterSymbol);
                                
                                            // Check if a filter is applied to this header
                                            if (storedFilters[i] && storedFilters[i] !== 'all') {
                                                applyFilter(i, storedFilters[i]);
                                                // Highlight the filter symbol for this header
                                                highlightFilterSymbol(i, '#ffcc00');  // Change color to your preference
                                            }
                                        }
                                
                                        function showFilterDropdown(columnIndex) {
                                            // Check if the dropdown is already open
                                            const existingDropdown = document.getElementById('filterDropdown');
                                            if (existingDropdown) {
                                                // Dropdown is open, close it
                                                document.body.removeChild(existingDropdown);
                                                return;
                                            }
                                
                                            const values = Array.from(new Set(Array.from(table.rows).slice(1).map(row => row.cells[columnIndex].textContent)));
                                            const dropdown = document.createElement('select');
                                            dropdown.id = 'filterDropdown'; // Set an ID to easily identify the dropdown
                                            dropdown.innerHTML = '<option value="all" style="text-align:center">All</option>';
                                
                                            // Modify to create a multiple selection dropdown
                                            dropdown.multiple = true;
                                
                                            values.forEach(value => {
                                                const option = document.createElement('option');
                                                option.value = value;
                                                option.text = value;
                                                dropdown.add(option);
                                            });
                                
                                            // Set selected values from stored filters
                                            if (storedFilters[columnIndex] && storedFilters[columnIndex] !== 'all') {
                                                const selectedValues = storedFilters[columnIndex].split(',');
                                                Array.from(dropdown.options).forEach(option => {
                                                    option.selected = selectedValues.includes(option.value);
                                                });
                                            }
                                
                                            dropdown.onchange = function () {
                                                const selectedOptions = Array.from(this.options).filter(option => option.selected);
                                                const selectedValues = selectedOptions.map(option => option.value).join(',');
                                
                                                applyFilter(columnIndex, selectedValues);
                                
                                                // Highlight the filter symbol for this header
                                                if (selectedValues === 'all') {
                                                    highlightFilterSymbol(columnIndex, ''); // Remove highlight when 'All' is selected
                                                } else {
                                                    highlightFilterSymbol(columnIndex, '#ffcc00'); // Change color to your preference
                                                }
                                
                                                document.body.removeChild(dropdown);
                                            };
                                
                                            const filterSymbol = headers[columnIndex].lastChild;
                                            const rect = filterSymbol.getBoundingClientRect();
                                            dropdown.style.position = 'absolute';
                                            dropdown.style.top = rect.bottom + 'px';
                                            dropdown.style.left = rect.left + 'px';
                                            document.body.appendChild(dropdown);
                                        }
                                
                                
                                
                                        function applyFilter(columnIndex, filterValue) {
                                            storedFilters[columnIndex] = filterValue;
                                            for (let i = 1; i < table.rows.length; i++) {
                                                let rowMatchesFilters = true;
                                                for (const index in storedFilters) {
                                                    const cellValue = table.rows[i].cells[index].textContent;
                                                    const filterValues = storedFilters[index].split(',');
                                                    if (storedFilters[index] !== 'all' && !filterValues.includes(cellValue)) {
                                                        rowMatchesFilters = false;
                                                        break;
                                                    }
                                                }
                                                table.rows[i].style.display = rowMatchesFilters ? '' : 'none';
                                            }
                                            sessionStorage.setItem('tableFilters', JSON.stringify(storedFilters));
                                        }
                                
                                        function highlightFilterSymbol(columnIndex, color) {
                                            // Change the color of the filter symbol for the specified header
                                            const filterSymbol = headers[columnIndex].lastChild;
                                            filterSymbol.style.color = color;
                                        }
                                
                                        
                                    });
                                </script> -->

                                
<!-- <script>
    document.addEventListener('DOMContentLoaded', function () {
    const table = document.getElementById('table');
    const headers = table.getElementsByTagName('th');
    const storedFilters = JSON.parse(sessionStorage.getItem('tableFilters')) || {};

    // Update filter symbols and apply stored filters
    for (let i = 1; i < headers.length - 1; i++) {
        const filterSymbol = document.createElement('span');
        // filterSymbol.innerHTML = ' &#9660;';
        filterSymbol.innerHTML = '<span style="font-size: smaller;">&#9660;</span>';
        filterSymbol.style.cursor = 'pointer';
        filterSymbol.onclick = function () {
            showFilterDropdown(i);
        };
        headers[i].innerHTML = headers[i].textContent;          // Clear existing content
        headers[i].appendChild(filterSymbol);

        // Check if a filter is applied to this header
        if (storedFilters[i] && storedFilters[i] !== 'all') {
            applyFilter(i, storedFilters[i]);
            // Highlight the filter symbol for this header
            highlightFilterSymbol(i, '#ffcc00');  // Change color to your preference
        }
    }

    function showFilterDropdown(columnIndex) {
        const values = Array.from(new Set(Array.from(table.rows).slice(1).map(row => row.cells[columnIndex].textContent)));
        const dropdown = document.createElement('select');
        dropdown.innerHTML = '<option value="all">All</option>';

        values.forEach(value => {
            const option = document.createElement('option');
            option.value = value;
            option.text = value;
            dropdown.add(option);
        });

        dropdown.value = storedFilters[columnIndex] || 'all';

        dropdown.onchange = function () {
            applyFilter(columnIndex, this.value);
            // Highlight the filter symbol for this header
            highlightFilterSymbol(columnIndex, '#ffcc00');  // Change color to your preference
            document.body.removeChild(dropdown);             // dropdown auto remove after filter applied
        };

        const filterSymbol = headers[columnIndex].lastChild;
        const rect = filterSymbol.getBoundingClientRect();
        dropdown.style.position = 'absolute';
        dropdown.style.top = rect.bottom + 'px';
        dropdown.style.left = rect.left + 'px';
        document.body.appendChild(dropdown);
    }

    function applyFilter(columnIndex, filterValue) {
        storedFilters[columnIndex] = filterValue;

        for (let i = 1; i < table.rows.length; i++) {
            let rowMatchesFilters = true;
            for (const index in storedFilters) {
                const cellValue = table.rows[i].cells[index].textContent;
                if (storedFilters[index] !== 'all' && cellValue !== storedFilters[index]) {
                    rowMatchesFilters = false;
                    break;
                }
            }
            table.rows[i].style.display = rowMatchesFilters ? '' : 'none';
        }

        sessionStorage.setItem('tableFilters', JSON.stringify(storedFilters));
    }

    function highlightFilterSymbol(columnIndex, color) {
        // Change the color of the filter symbol for the specified header
        const filterSymbol = headers[columnIndex].lastChild;
        filterSymbol.style.color = color;
    }
});

</script> -->
<!-- ------------------------------------------------------------------------------------------------------------------------- -->
             


<script>
    // After 2 seconds, refresh the page
    setTimeout(function() {
        location.reload();
    }, 300000);
</script>

